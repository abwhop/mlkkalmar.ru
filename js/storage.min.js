(function(win){var _storage=function(name,value){var self;if(typeof Storage=="undefined"){throw Error("_storage: Web Storage no support")}if(_storage.prototype.instance){self=_storage.prototype.instance}else{self=Object.create(_storage.prototype);_storage.prototype.instance=self;self._init()}if(arguments.length==1)return self.get(name);if(arguments.length==2)self.set(name,value);return self};_storage.prototype={_list:{},_init:function(){win.addEventListener("storage",this._storageEvent.bind(this))},subscribe:function(name,callback){if(name!=undefined&&typeof callback=="function"){if(!this._list.hasOwnProperty(name)){this._list[name]=[]}this._list[name].push(callback)}return this},unSubscribe:function(name,callback){if(this._list.hasOwnProperty(name)&&this._list[name].length){if(typeof callback=="function"){this._list[name].some(function(el,i,arr){if(el==callback){arr.splice(i,1);return true}})}else{delete this._list[name]}}return this},_storageEvent:function(e){e=e||window.event;if(this._list.hasOwnProperty(e.key)){var that=this;this._list[e.key].forEach(function(callback){callback(that.get(e.key),e)})}},get:function(name){var value=localStorage.getItem(name);var replace={0:function(){return null},n:function(v){return Number(v)},b:function(v){return"true"===v},d:function(v){return new Date(v)},f:function(v){return Function("return "+v)()}};return value&&/^:[bdfn0]:/.test(value)?replace[value.slice(1,2)](value.slice(3)):JSON.parse(value)},set:function(name,value){var alias={Null:"0",Date:"d",Number:"n",Boolean:"b",Function:"f"};var type=Object.prototype.toString.call(value).split(/\s|]/)[1];if(alias.hasOwnProperty(type)){switch(alias[type]){case"d":case"f":value=value.toString();break;default:value=JSON.stringify(value)}value=":"+alias[type]+":"+value}else{value=JSON.stringify(value)}localStorage.setItem(name,value);return this},remove:function(name){localStorage.removeItem(name);return this},clear:function(){localStorage.clear();return this}};win._storage=_storage})(window);